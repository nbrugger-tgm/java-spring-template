plugins {
    id 'org.sonarqube' version '3.3'
    id 'com.bmuschko.docker-remote-api' version '7.1.0'
}

allprojects {
    apply from: "${rootDir}/modules/config.gradle"
    version = '0.5.0b5'
    group = project.ext.rootPackage
}

apply from: "${rootDir}/modules/deployment.gradle"
subprojects {
    if (!name.equals("client"))
        apply from: "${rootDir}/modules/submodule.gradle"
}

sonarqube {
    properties {
        property 'sonar.projectName', project.ext.displayName
        property "sonar.sourceEncoding", "UTF-8"
        property "sonar.projectKey", project.ext.sonarProjectKey
        property "sonar.organization", project.ext.sonarOrganization
        property "sonar.host.url", project.ext.sonarHost
        property "sonar.tests", "src/intTest,src/archTest,src/test"
        property "sonar.coverage.exclusions", "**/controllers/**/*.*, **/entities/**/*.*, **/models/**/*.*"
        property "sonar.exclusions", "**/client/java/**/*.*"//java client is automatically generated
    }
}

project("client") {
    afterEvaluate {
        publishing {
            repositories {
                maven {
                    name = "Artifactory"
                    url = project.ext.mvnRepoUrl
                    credentials {
                        username = project.ext.mvnRepoUser
                        password = System.getenv(project.ext.mvnRepoEnvKey)
                    }
                }
            }
        }
    }
}